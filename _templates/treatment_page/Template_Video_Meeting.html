{% extends "global/Page.html" %}
{% block content %}
{% load static %}
<style>
/* General container styling */
.container-fluid {
    height: 90vh; /* Full height reduced by 10% */
    display: flex;
    flex-direction: row;
}


/* Styling for the video container to match right-side height */
.video-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60%; /* Increased width by 20% */
    height: 100%; /* Exact height match with right side */
    border: 1px solid black; /* Add a border around the video container */
}

.placeholder-text {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.1); /* Leichter grauer Hintergrund */
    color: black;
    font-size: 1.5rem;
    font-weight: bold;
}

/* Styling for the right-side content (instructions, notes, etc.) */
.right-container {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 40%; /* Increased width by 20% */
    height: 100%; /* Exact height match with the video container */
}

/* Content container for dynamic elements */
.content-container {
    border: 2px solid red; /* Add a red border for clarity */
    flex: 1; /* Take up half of the right container */
    margin-bottom: 10px; /* Add spacing between the two sections */
    display: flex;
    align-items: center; /* Center content vertically */
    justify-content: center; /* Center content horizontally */
    text-align: center;
}

/* Notes container styling */
.notes-container {
    border: 1px solid black; /* Add a border around the notes container */
    flex: 1; /* Take up the remaining space in the right container */
}

/* Prevent users from resizing the textarea */
textarea {
    resize: none;
    width: 100%; /* Make textarea full width */
    height: 100%; /* Make textarea fill the notes container */
}

/* Ensure the iframe (Jitsi meeting) fills its container */
iframe {
    width: 100%; /* Make the iframe stretch horizontally */
    height: 100%; /* Make the iframe stretch vertically */
    border: none; /* Remove the default border of the iframe */
}
</style>



<div class="container-fluid">

    <!--Video meeting (left side, matches height of right side) -->
    <div class="video-container">
        <div id="video-placeholder" class="placeholder-text">
            <h2>Das Meeting ist derzeit deaktiviert.</h2>
            <p>Bitte warten Sie, bis das Meeting aktiviert wird.</p>
        </div>
        <iframe id="jitsi-frame" src="https://meet.jit.si/example" allow="camera; microphone"></iframe>
    </div>


    <!-- Right side: dynamic content and notes (stacked) -->
    <div class="right-container">

        <!-- Dynamic content container -->
        <div class="content-container">
            <div id="content">
                <h4>Wechselnde Inhalte</h4> <!-- Placeholder heading -->
            </div>
        </div>

        <!-- Notes container -->
        <div class="notes-container">
            <textarea
                id="notes"
                class="form-control"
                placeholder="Hier Notizen eingeben..."
            ></textarea>
        </div>
    </div>
</div>

<!-- Progressbar-Container -->
<div style="width: 100%; background-color: #f3f3f3; border: 1px solid #ccc; border-radius: 5px; margin: 20px 0;">
    <!-- Fortschrittsbalken -->
    <div id="progress-bar" style="width: 0%; background-color: #4caf50; height: 25px; text-align: center; color: white; line-height: 25px; border-radius: 5px;">
        0%
    </div>
</div>


<audio id = "Audio">
  <source src="{{ static 'MCCR.mp3' }}" type="audio/mpeg">
</audio>



<div id="timeout" data-remaining="{{ timeout_seconds }}"></div>


<script>

document.addEventListener("DOMContentLoaded", function () {


   // Dauer in Millisekunden
    const duration = 480000; // 8 Minuten
    const progressBar = document.getElementById("progress-bar");

    let startTime = null;

    function updateProgress(timestamp) {
        if (!startTime) startTime = timestamp;

        // Berechne verstrichene Zeit
        const elapsed = timestamp - startTime;

        // Berechne den Fortschritt in Prozent
        const progress = Math.min((elapsed / duration) * 100, 100);

        // Setze die Breite der Progressbar und den Text
        progressBar.style.width = progress + "%";
        progressBar.innerHTML = Math.round(progress) + "%";

        // Wenn die Zeit noch nicht abgelaufen ist, f√ºhre die Funktion erneut aus
        if (elapsed < duration) {
            requestAnimationFrame(updateProgress);
        } else {
            // Optional: Aktion, wenn die Progressbar fertig ist
            progressBar.innerHTML = "Fertig!";
        }
    }

    // Starte die Progressbar
    requestAnimationFrame(updateProgress);

    // References to important elements
    const contentDiv = document.getElementById("content"); // Div that displays dynamic content
    const notesTextarea = document.getElementById("notes"); // Textarea for user notes
    const jitsiFrame = document.getElementById("jitsi-frame"); // Jitsi meeting iframe
    const videoPlaceholder = document.getElementById("video-placeholder"); // Placeholder text

 var audio = document.getElementById('Audio');
    audio.play();

    // setup at beginning
    notesTextarea.disabled = true;
    jitsiFrame.style.display = "none"; // Hide Jitsi iframe initially
    videoPlaceholder.style.display = "flex"; // Show placeholder text
    jitsiFrame.src = ''; // Disable the Jitsi meeting by clearing the iframe source
    contentDiv.textContent = "Announcement in progress";



   let timeout = parseInt(document.getElementById("timeout").getAttribute('data-remaining'));

    let remainingTime = timeout;

    console.log("test");


    let notesData = ''; // Variable to store the notes entered by the user

  // Countdown
    const interval = setInterval(() => {
        remainingTime--;
       // contentDiv.textContent = remainingTime;

         // Notes
        if (remainingTime === 468) {
            notesTextarea.disabled = false; // Enable the textarea for input
            notesTextarea.value = ''; // Clear any previous text
            contentDiv.textContent = "Take some notes on what would be your prefered outcome when going on an enjoyable holiday with a team, microphone and camera will not be available";

        }

       // Announcement
        if (remainingTime === 450) {
           notesTextarea.disabled = true; // Disable the textarea for input
            notesTextarea.value = ''; // Clear any previous text
            jitsiFrame.src = '';
             jitsiFrame.style.display = "none"; // Hide Jitsi iframe
            videoPlaceholder.style.display = "flex"; // Show placeholder text
             contentDiv.textContent = "Announcement in progress";

        }

         // Ruhephase
        if (remainingTime === 438) {
           notesTextarea.disabled = true; // Disable the textarea for input
             contentDiv.textContent = "Please close your eyes";

        }

         // Announcement
        if (remainingTime === 419) {
           notesTextarea.disabled = true; // Disable the textarea for input
            notesTextarea.value = ''; // Clear any previous text
            jitsiFrame.src = '';
             jitsiFrame.style.display = "none"; // Hide Jitsi iframe
            videoPlaceholder.style.display = "flex"; // Show placeholder text
             contentDiv.textContent = "Announcement in progress";
             }

         // Video Meeting
        if (remainingTime === 410) {
            notesTextarea.disabled = true;
            notesData = notesTextarea.value;
            jitsiFrame.src = "https://meet.jit.si/example";
             jitsiFrame.style.display = "block"; // Show Jitsi iframe
            videoPlaceholder.style.display = "none"; // Hide placeholder text
            contentDiv.textContent = "video-meeting in progress, share your thoughts";

        }

        // Announcement
        if (remainingTime === 323) {
           notesTextarea.disabled = true; // Disable the textarea for input
            notesTextarea.value = ''; // Clear any previous text
            jitsiFrame.src = '';
             jitsiFrame.style.display = "none"; // Hide Jitsi iframe
            videoPlaceholder.style.display = "flex"; // Show placeholder text
             contentDiv.textContent = "Announcement in progress";
             }

              // Notes
        if (remainingTime === 316) {
            notesTextarea.disabled = false; // Enable the textarea for input
            notesTextarea.value = ''; // Clear any previous text
            contentDiv.textContent = "";

        }

        // Announcement
        if (remainingTime === 296) {
           notesTextarea.disabled = true; // Disable the textarea for input
            jitsiFrame.src = '';
             jitsiFrame.style.display = "none"; // Hide Jitsi iframe
            videoPlaceholder.style.display = "flex"; // Show placeholder text
             contentDiv.textContent = "Announcement in progress";
             }

        // Ruhephase
        if (remainingTime === 283) {
           notesTextarea.disabled = true; // Disable the textarea for input
             contentDiv.textContent = "Please close your eyes";

        }

         // Announcement
        if (remainingTime === 250) {
           notesTextarea.disabled = true; // Disable the textarea for input
            jitsiFrame.src = '';
             jitsiFrame.style.display = "none"; // Hide Jitsi iframe
            videoPlaceholder.style.display = "flex"; // Show placeholder text
             contentDiv.textContent = "Announcement in progress";
             }


            // Video Meeting
        if (remainingTime === 238) {
            notesTextarea.disabled = true;
            notesData = notesTextarea.value;
            jitsiFrame.src = "https://meet.jit.si/example";
             jitsiFrame.style.display = "block"; // Show Jitsi iframe
            videoPlaceholder.style.display = "none"; // Hide placeholder text
            contentDiv.textContent = "video-meeting in progress, share your thoughts";

        }

         // Announcement
        if (remainingTime === 165) {
           notesTextarea.disabled = true; // Disable the textarea for input
            jitsiFrame.src = '';
             jitsiFrame.style.display = "none"; // Hide Jitsi iframe
            videoPlaceholder.style.display = "flex"; // Show placeholder text
             contentDiv.textContent = "Announcement in progress";
             }


              // Notes
        if (remainingTime === 150) {
            notesTextarea.disabled = false; // Enable the textarea for input
            notesTextarea.value = ''; // Clear any previous text
            contentDiv.textContent = "";

        }
  // Announcement
        if (remainingTime === 126) {
           notesTextarea.disabled = true; // Disable the textarea for input
            jitsiFrame.src = '';
             jitsiFrame.style.display = "none"; // Hide Jitsi iframe
            videoPlaceholder.style.display = "flex"; // Show placeholder text
             contentDiv.textContent = "Announcement in progress";
             }

         // Video Meeting
        if (remainingTime === 116) {
            notesTextarea.disabled = true;
            notesData = notesTextarea.value;
            jitsiFrame.src = "https://meet.jit.si/example";
             jitsiFrame.style.display = "block"; // Show Jitsi iframe
            videoPlaceholder.style.display = "none"; // Hide placeholder text
            contentDiv.textContent = "video-meeting in progress, share your thoughts";

        }


        // stops Countdown when time is up
        if (remainingTime <= 0) {
            clearInterval(interval);


        }
    }, 1000); // reduces time every second


});


</script>
{{ endblock }}
